<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProPlugin Price Tag Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- Global Styles & Theme --- */
        :root {
            --bg-color: #1a1a1a;
            --bg-light: #2c2c2c;
            --text-color: #ffffff;
            --primary-color: #e50914;
            --border-color: #444444;
            --font-main: 'Kanit', 'Prompt', sans-serif;
        }
        * { box-sizing: border-box; }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            margin: 0;
            font-size: 14px;
            line-height: 1.6;
        }
        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .hidden { display: none !important; }

        /* --- Login Screen --- */
        #login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #login-form {
            background-color: var(--bg-light);
            padding: 40px;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
        }
        #login-form h1 {
            text-align: center;
            margin-top: 0;
            color: var(--primary-color);
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 4px;
        }
        #login-error {
            color: var(--primary-color);
            text-align: center;
            min-height: 20px;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: var(--text-color);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: var(--font-main);
            font-size: 16px;
            font-weight: 500;
        }
        button:hover { opacity: 0.9; }
        button:disabled { background-color: #555; cursor: not-allowed; }

        /* --- Main App UI --- */
        #app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 20px;
        }
        #app-header h1 {
            margin: 0;
            font-size: 24px;
        }
        #user-info button { width: auto; padding: 8px 16px; font-size: 14px; }
        #user-info .admin-link { margin-right: 15px; }

        /* Controls */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            background-color: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
        }
        .control-group { display: flex; flex-direction: column; }
        .control-group label { margin-bottom: 8px; font-weight: 500;}
        .control-group input, .control-group select {
            padding: 10px;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 4px;
        }
        .main-actions button { width: auto; padding: 10px 20px;}

        /* Table */
        .table-container { overflow-x: auto; }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--bg-light);
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }
        th {
            background-color: #333;
            font-weight: 500;
        }
        tbody tr:hover { background-color: #3a3a3a; }
        td .details-list {
            padding-left: 15px; margin: 0; max-width: 300px;
            white-space: normal; font-size: 12px;
        }
        td .gp-value { color: #4CAF50; font-weight: bold; }
        [data-column="normal_price"] { text-decoration: line-through; color: #999; }

        /* Pagination */
        #pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        #pagination button {
            width: auto;
            margin: 0 5px;
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
        }
        #pagination button.active { background-color: var(--primary-color); }

        /* --- Admin Panel --- */
        #admin-panel {
            background-color: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
        }
        #admin-panel h2 { color: var(--primary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        .admin-section { margin-bottom: 30px; }
        .admin-section .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .admin-section textarea {
            width: 100%; height: 100px; background-color: var(--bg-color);
            border: 1px solid var(--border-color); color: var(--text-color); border-radius: 4px;
            padding: 10px;
        }
        #logo-preview { max-width: 200px; max-height: 80px; background-color: #fff; padding: 5px; border-radius: 4px; margin-top: 10px; }

        /* --- Preview Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 1000px;
            border: 1px solid var(--border-color);
            position: relative;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; }
        .modal-close { font-size: 24px; cursor: pointer; background: none; border: none; color: white; }
        .modal-body { display: flex; gap: 20px; }
        .modal-controls { flex: 0 0 250px; }
        .modal-preview-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; background: #555; min-height: 500px; overflow: auto;}
        .preview-nav button { width: auto; margin: 0 5px; }

        /* --- Price Tag Styles (for Preview) --- */
        .price-tag-preview-wrapper {
            background: white;
            color: black;
            font-family: 'Kanit', sans-serif;
            position: relative;
            overflow: hidden;
            transform-origin: top center;
        }
        .price-tag-preview-wrapper[data-template="A4"] { width: 210mm; height: 297mm; }
        .price-tag-preview-wrapper[data-template="A5"] { width: 148mm; height: 210mm; }
        .price-tag-preview-wrapper[data-template="A6"] { width: 105mm; height: 148mm; }
        .price-tag-preview-wrapper[data-template="Acc"] { width: 99mm; height: 70mm; /* Approx 1/3 of A6 landscape */ }

        .tag-border {
            position: absolute;
            top: 5mm; left: 5mm; right: 5mm; bottom: 5mm;
            border: 2.5mm solid black;
            display: flex;
            flex-direction: column;
        }
        .tag-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 5mm;
        }
        .tag-logo { max-width: 25%; max-height: 15mm; object-fit: contain; }
        .tag-sku { font-size: 4mm; font-weight: 500; }
        .tag-body {
            flex-grow: 1;
            padding: 0 10mm;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .tag-brand { font-size: 6mm; font-weight: 300; margin: 0; }
        .tag-name { font-size: 14mm; font-weight: 700; margin: 0; line-height: 1.2; }
        .tag-details {
            margin-top: 8mm;
            padding-left: 5mm;
            font-size: 4.5mm;
            list-style-type: '• ';
        }
        .tag-footer {
            min-height: 30mm;
            background: var(--primary-color);
            color: white;
            margin: 5mm;
            padding: 4mm 8mm;
            position: relative;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
        .tag-expire {
            position: absolute;
            left: 8mm;
            top: 4mm;
            font-size: 4mm;
            font-weight: 300;
        }
        .tag-normal-price {
            text-decoration: line-through;
            font-size: 8mm;
            font-weight: 500;
            margin-right: 10mm;
            opacity: 0.8;
        }
        .tag-promo-price {
            font-size: 18mm;
            font-weight: 700;
            line-height: 1;
        }
        /* Acc Tag Specifics */
        .price-tag-preview-wrapper[data-template="Acc"] .tag-border {
            top: 2mm; left: 2mm; right: 2mm; bottom: 2mm; border-width: 1mm;
        }
        .price-tag-preview-wrapper[data-template="Acc"] .tag-header { padding: 2mm; }
        .price-tag-preview-wrapper[data-template="Acc"] .tag-logo { max-height: 8mm; }
        .price-tag-preview-wrapper[data-template="Acc"] .tag-sku { font-size: 2.5mm; }
        .price-tag-preview-wrapper[data-template="Acc"] .tag-body { padding: 0 4mm; justify-content: flex-start; }
        .price-tag-preview-wrapper[data-template="Acc"] .tag-brand { font-size: 3mm; margin-top: 2mm;}
        .price-tag-preview-wrapper[data-template="Acc"] .tag-name { font-size: 4.5mm; }
        .price-tag-preview-wrapper[data-template="Acc"] .tag-details { display: none; } /* No details on Acc tag */
        .price-tag-preview-wrapper[data-template="Acc"] .tag-footer {
            margin: 2mm; padding: 2mm 4mm; min-height: 15mm;
        }
        .price-tag-preview-wrapper[data-template="Acc"] .tag-expire {
            font-size: 2mm; top: 2mm; left: 4mm;
        }
        .price-tag-preview-wrapper[data-template="Acc"] .tag-normal-price { font-size: 4mm; margin-right: 4mm; }
        .price-tag-preview-wrapper[data-template="Acc"] .tag-promo-price { font-size: 7mm; }

        /* --- Print Styles --- */
        @media print {
            body, .container, .modal-overlay {
                margin: 0;
                padding: 0;
                background: white;
            }
            #login-screen, #app-container { display: none; }
            #print-area { display: block; }
            @page {
                size: A4;
                margin: 0;
            }
            .print-page {
                width: 210mm;
                height: 297mm;
                page-break-after: always;
                display: flex;
                flex-wrap: wrap;
                align-content: flex-start;
                overflow: hidden;
            }
            .print-tag-wrapper {
                color: black;
                font-family: 'Kanit', sans-serif;
                position: relative; /* Changed from absolute for flow */
                overflow: hidden;
                box-sizing: border-box; /* Important for layout */
            }
            /* Layouts */
            .print-layout-A4 .print-tag-wrapper { width: 210mm; height: 297mm; }
            .print-layout-A5 .print-tag-wrapper { width: 148.5mm; height: 210mm; } /* A5 is half of A4 landscape */
            .print-layout-A6 .print-tag-wrapper { width: 105mm; height: 148.5mm; }
            .print-layout-Acc .print-tag-wrapper { width: 105mm; height: 74.25mm; } /* 4 rows of 2x Acc tags landscape */
            /* A5 Special: 2 side-by-side */
            .print-layout-A5 {
                display: grid !important;
                grid-template-columns: 148.5mm 148.5mm;
                width: 297mm; /* Landscape */
                height: 210mm;
                transform: rotate(-90deg) translateX(-210mm);
                transform-origin: top left;

            }
             .print-layout-A5 .print-tag-wrapper {
                width: 148.5mm; height: 210mm;
             }

        }
        #print-area { display: none; }

    </style>
</head>
<body>

    <div id="login-screen">
        <div id="login-form">
            <h1>Price Tag System</h1>
            <p id="login-error"></p>
            <div class="form-group">
                <label for="username">ชื่อผู้ใช้</label>
                <input type="text" id="username" value="host1">
            </div>
            <div class="form-group">
                <label for="password">รหัสผ่าน</label>
                <input type="password" id="password" value="host123">
            </div>
            <button id="login-button">เข้าสู่ระบบ</button>
        </div>
    </div>

    <div id="app-container" class="container hidden">
        <header id="app-header">
            <h1>ProPlugin Price Tag</h1>
            <div id="user-info">
                <span id="welcome-message"></span>
                <button class="admin-link hidden" id="admin-panel-button">แผงควบคุม</button>
                <button id="logout-button">ออกจากระบบ</button>
            </div>
        </header>

        <main id="main-view">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="search-input">ค้นหา (SKU, ชื่อสินค้า)</label>
                    <input type="text" id="search-input" placeholder="พิมพ์เพื่อค้นหา...">
                </div>
                <div class="control-group">
                    <label for="expire-filter">กรองตามวันหมดอายุโปรโมชั่น</label>
                    <input type="date" id="expire-filter">
                </div>
                <div class="control-group">
                    <label for="channel-selector">ช่องทางการขาย</label>
                    <select id="channel-selector">
                        <option value="Flagship">Flagship / Website</option>
                        <option value="Dealer">Dealer</option>
                        <option value="Marketplace">Marketplace</option>
                    </select>
                </div>
                <div class="control-group main-actions">
                     <label>&nbsp;</label>
                    <button id="preview-selected-button" disabled>ดูตัวอย่างป้ายราคา</button>
                </div>
            </div>

            <div class="table-container">
                <table id="sku-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="pagination"></div>
        </main>

        <aside id="admin-panel" class="hidden">
            <button id="back-to-main-view">← กลับไปหน้าหลัก</button>
            <h1>แผงควบคุม</h1>

            <div class="admin-section" id="user-management-section">
                <h2>จัดการผู้ใช้งาน</h2>
                <p>การจัดการผู้ใช้งานจะถูกกำหนดค่าโดยตรงในโค้ด (สำหรับ Host)</p>
            </div>

            <div class="admin-section">
                <h2>จัดการข้อมูลสินค้า (SKU)</h2>
                 <p>นำเข้าข้อมูลล่าสุดจากไฟล์ Excel (.xlsx) ของคุณ</p>
                <input type="file" id="excel-file-input" accept=".xlsx, .xls">
                <button id="export-csv-button">ส่งออกข้อมูลเป็น CSV</button>
            </div>

            <div class="admin-section">
                <h2>ตั้งค่าทั่วไป</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="logo-upload">อัพโหลดโลโก้บริษัท</label>
                        <input type="file" id="logo-upload" accept="image/*">
                        <img id="logo-preview" src="" alt="Logo Preview">
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h2>ตั้งค่า Dealer</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="dealer-tier1-name">ชื่อ Tier 1</label>
                        <input type="text" id="dealer-tier1-name">
                    </div>
                    <div class="form-group">
                        <label for="dealer-tier2-name">ชื่อ Tier 2</label>
                        <input type="text" id="dealer-tier2-name">
                    </div>
                    <div class="form-group">
                        <label for="dealer-tier3-name">ชื่อ Tier 3</label>
                        <input type="text" id="dealer-tier3-name">
                    </div>
                     <div class="form-group">
                        <label for="default-dealer-tier">Tier เริ่มต้นสำหรับพิมพ์</label>
                        <select id="default-dealer-tier">
                            <option value="T1">Tier 1</option>
                            <option value="T2">Tier 2</option>
                            <option value="T3">Tier 3</option>
                        </select>
                    </div>
                </div>
                 <button id="save-settings-button">บันทึกการตั้งค่า</button>
            </div>

            <div class="admin-section">
                <h2>ประวัติการใช้งาน (Logs)</h2>
                <button id="export-logs-button">ส่งออก Logs เป็น CSV</button>
                <div class="table-container">
                    <table id="logs-table">
                        <thead>
                            <tr><th>Timestamp</th><th>User</th><th>Action</th><th>Details</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

        </aside>

    </div>

    <div id="preview-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div class="preview-nav">
                     <button id="prev-sku-button">‹ ก่อนหน้า</button>
                     <span id="sku-counter"></span>
                     <button id="next-sku-button">ถัดไป ›</button>
                </div>
                <h2>ตัวอย่างป้ายราคา</h2>
                <button class="modal-close" id="close-modal-button">×</button>
            </div>
            <div class="modal-body">
                <div class="modal-controls">
                    <div class="control-group">
                        <label for="preview-template-selector">เลือกแม่แบบ</label>
                        <select id="preview-template-selector">
                            <option value="A4">A4 (1 per page)</option>
                            <option value="A5">A5 (2 per page)</option>
                            <option value="A6" selected>A6 (4 per page)</option>
                            <option value="Acc">Accessories Tag (12 per page)</option>
                        </select>
                    </div>
                    <div class="control-group hidden" id="preview-dealer-tier-group">
                        <label for="preview-dealer-tier-selector">เลือก Dealer Tier</label>
                        <select id="preview-dealer-tier-selector">
                            </select>
                    </div>
                    <br>
                    <button id="print-button">พิมพ์ / ส่งออกเป็น PDF</button>
                </div>
                <div class="modal-preview-area">
                    </div>
            </div>
        </div>
    </div>

    <div id="print-area"></div>

<script>
// Logic will be placed here
</script>
</body>
</html>
